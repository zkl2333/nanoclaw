# Telegram 增强功能

NanoClaw 的 Telegram 频道现在支持回复、引用和表情反应功能。

## 功能说明

### 1. 消息回复 (Reply)

Agent 可以回复特定的消息。在消息格式中，每条消息都有一个 `id` 属性和可选的 `reply_to` 属性。

**消息格式示例：**
```xml
<messages>
  <message id="123" sender="Alice" time="2026-02-12T10:00:00Z">你好</message>
  <message id="124" sender="Bob" time="2026-02-12T10:01:00Z" reply_to="123">你好！</message>
</messages>
```

**Agent 如何回复：**
```
REPLY_TO:123
这是对消息 123 的回复
```

### 2. 表情反应 (Emoji Reactions)

Agent 可以对消息添加表情反应。

**Agent 如何添加反应：**
```
REACT:123:👍
```

这会在消息 123 上添加 👍 表情。

**支持的表情：**
- 👍 👎 ❤️ 🔥 🥰 👏 😁 🤔 🤯 😱
- 🤬 😢 🎉 🤩 🤮 💩 🙏 👌 🕊 🤡
- 🥱 🥴 😍 🐳 ❤️‍🔥 🌚 🌭 💯 🤣 ⚡
- 🍌 🏆 💔 🤨 😐 🍓 🍾 💋 🖕 😈
- 😴 😭 🤓 👻 👨‍💻 👀 🎃 🙈 😇 😨
- 🤝 ✍️ 🤗 🫡 🎅 🎄 ☃️ 💅 🤪 🗿
- 🆒 💘 🙉 🦄 😘 💊 🙊 😎 👾 🤷‍♂️
- 🤷 🤷‍♀️ 😡

### 3. 引用显示

当用户回复某条消息时，系统会自动捕获 `reply_to_message_id`，Agent 可以看到消息之间的引用关系。

## 使用示例

### 示例 1：回复用户消息

**用户消息：**
```
你能帮我解释一下这个代码吗？
```

**Agent 回复：**
```
REPLY_TO:125
当然可以！这段代码的作用是...
```

### 示例 2：添加表情反应

**用户消息：**
```
我完成了任务！
```

**Agent 反应：**
```
REACT:126:🎉
```

### 示例 3：组合使用

Agent 可以先回复，然后再添加表情：

```
REPLY_TO:127
太棒了！继续加油！
```

然后在另一条输出中：
```
REACT:127:👍
```

## 技术实现

- 数据库添加了 `reply_to_message_id` 字段
- 消息格式包含 `id` 和 `reply_to` 属性
- Telegram channel 解析特殊命令：
  - `REPLY_TO:message_id\n<text>` - 回复消息
  - `REACT:message_id:emoji` - 添加表情反应
- 自动捕获用户消息的回复关系

## 注意事项

1. 消息 ID 必须是有效的 Telegram 消息 ID
2. 表情必须是 Telegram 支持的表情
3. 回复命令必须在消息开头，格式严格
4. 表情反应命令必须单独一行，不能包含其他内容
